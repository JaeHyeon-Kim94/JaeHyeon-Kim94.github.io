---
title : JPA(9_1) - 영속성 전이
categories : [jpa]
tags: [jpa, hibernate]
published : false
---

 - **영속성 전이** : 엔티티 영속화시 연관된 엔티티도 함께 영속상태로 만드는 기능. by CASCADE.

 - CascadeType
   - ALL : 모두 적용
   - PERSIST : 영속
   - MERGE : 병합
   - REMOVE : 삭제
   - REFRESH : refresh
   - DETACH : detach


   - persist와 remove는 persist(), remove() 실행시 전이가 발생하지 않고 플러시 호출시 전이가 발생한다.


 - cascadeType 없이 영속성 전이를 위해선 각 엔티티에 대해 전부 persist 필요. 하지만 cascadeType persist를 이용하면 엔티티 하나에 대해 한 번만 persist 수행하면 됨.(308, 309)


 <hr><hr><br>





 - **고아 객체** : 부모 엔티티와 연관관계가 끊어진 자식 엔티티를 자동으로 삭제.(고아 제거) 따라서 부모 엔티티 컬렉션에서 자식 엔티티에 대한 참조만 제거하면 자식 엔티티가 자동으로 삭제되도록 할 수 있다.


 - @OneToMany( ... orphanRemovla = true )
 - 영속성 컨텍스트를 플러시할 때 적용된다.
 - collection.remove()를 통해 특정 엔티티만 제거하도록 할 수도 있고 collection.cleart()를 통해 모든 자식 엔티티를 제거할 수도 있다.


 - orphanRemoval은 @OneToOne, @OneToMany에만 사용할 수 있다. 참조가 제거된 엔티티는 다른 곳에서 참조하지 않는다고 보고 제거하는 것이기 때문에 특정 엔티티에서만 참조할 때 사용해야 한다.


 - CascadeType.ALL + orpanRemoval = true : 부모 엔티티를 통해 자식 엔티티의 lifecycle을 관리할 수 있다.