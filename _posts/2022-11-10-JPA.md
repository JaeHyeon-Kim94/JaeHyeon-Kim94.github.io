---
categories : [jpa]
tags: [jpa, hibernate]
# published: false
---

1. JPA란?

 - 자바 ORM 기술에 관한 API 표준 명세로서, 인터페이스에 해당함.
 - 이러한 표준 명세를 구현한 구현체, 즉 ORM 프레임워크는 여러 종류가 있는데 Hibernate가 많이 쓰인다.
   - 따라서 사용하는 객체가 javax.persistence로 시작한다면 JPA 표준 속성이기 때문에 ORM 프레임워크에 종속적이지 않지만, hibernate로 시작한다면 hibernate 구현체이기 때문에 hibernate에서만 사용할 수 있다. 

 2.3 라이브러리와 프로젝트 구조

 - hibernate의 핵심 라이브러리
   - hibernate-core
   - hibernate-entitymanager : 하이버네이트가 JPA 구현체로서 동작하도록 구현한 라이브러리.
   - hibernate-jpa-2.1-api : JPA 2.1 표준 API를 모아둔 라이브러리



    2.4  기본적 매핑 어노테이션
     - @Entity : 이 클래스(엔티티 클래스)를 테이블과 매핑하겠다.
     - @Table(name="tableName") : 엔티티 클래스에 매핑할 테이블 정보를 명시한다. 생략시 클래스명.
     - @Id : primary key
     - @Column(name="columnName") : 필드를 컬럼에 매핑한다. 지정하지 않을 시 필드 명의 컬럼과 매핑되는데, DB에서 대소문자를 구별하는 경우에는 그에 맞게 대소문자를 맞춰준다.

    2.5 persistence 설정
    - persistence-unit : 연결할 DB당 하나의 영속성 유닛을 등록하며, 고유한 이름을 부여해야 한다.
    - 그 외에 필수 속성으로 jdbc driver, jdbc user, jdbc password, jdbc url, hibernate.dialect 설정이 필요하다.
    - Optional properties
      - hibernate.show_sql : 하이버네이트가 실행한 SQL 출력
      - hibernate.format_sql : 하이버네이트가 실행한 SQL을 출력할 때 보기 쉽게 정렬.
      - hibernate.use_sql_comments : 주석도 함께 출력.
      - hibernate.id.new_generator_mappings : JPA 표준에 맞춘 새로운 키 생성 전략 사용. TODO


    2.6 애플리케이션 개발

    - 엔티티 매니저 설정
      - 
      - EntityManagerFactory emf = Persistence.createEntityManagerFactory("영속성 유닛 이름");
        - emf는 생성 비용이 매우 크기 때문에 애플리케이션 전역에서 한 번만 생성하고 공유해서 사용.
      - EntityManager em = emf.createEntityManager();
        - em을 이용해 CRUD. 내부에 데이터소스 유지하며 DB와 통신
        - DB Connection과 밀접한 관계이므로 스레드간 공유 또는 재사용 금지.
      - em.close(), emf.close()
      - ![entity_manager_init_process.PNG](../../assets/img/entity_manager_init_process.PNG)
  
    - 트랜잭션 관리
      - JPA에서는 항상 트랜잭션 안에서 데이터 변경해야 하며 그렇지 않을 경우 예외 발생.
      - EntityTransaction tx = em.getTransaction();
      - tx.begin() //트랜잭션 시작
      
      - tx.commit(); //트랜잭션 커밋
      - tx.rollback(); //트랜잭션 롤백
      
    - 비즈니스 로직
      - logic(em) //비즈니스 로직 실행


    2.6.4 JPQL

    - SQL을 추상화 한 객체지향 쿼리 언어.
    - SQL과 문법이 거의 유사
    - 다만 차이점은 엔티티 객체를 대상으로 쿼리. SQL은 DB Table 대상.
      - JPQL은 테이블 전혀 알지 못함.
    - em.createQuery(JPQL, 반환 타입).getResultList();